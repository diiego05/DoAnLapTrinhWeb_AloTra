<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/default_layout :: body(content=~{::content}, additionalJs=~{::additionalJs})}">

<body>
<th:block th:fragment="content">

    <div class="container my-5">
        <div class="row">

            <!-- HÌNH ẢNH -->
            <div class="col-md-5">
                <th:block th:with="primaryImage=${product.media.?[isPrimary == true]}">
                    <img th:if="${!primaryImage.isEmpty()}"
                         th:src="${primaryImage[0].url}"
                         class="img-fluid rounded shadow-sm">
                </th:block>
                <th:block th:if="${product.media.?[isPrimary == true].isEmpty() && !product.media.isEmpty()}">
                    <img th:src="${product.media[0].url}" class="img-fluid rounded shadow-sm">
                </th:block>
                <img th:if="${product.media.isEmpty()}"
                     th:src="@{/images/placeholder.png}"
                     class="img-fluid rounded shadow-sm">
            </div>

            <!-- THÔNG TIN -->
            <div class="col-md-7">
                <h2 th:text="${product.name}">Tên sản phẩm</h2>
                <h3 class="fw-bold text-success my-3" id="product-price">0 ₫</h3>
                <hr>

                <!-- CHỌN SIZE -->
                <div class="mb-4">
                    <h5>Chọn kích cỡ</h5>
                    <div class="d-flex gap-2 flex-wrap" id="size-options">
                        <th:block th:each="variant, iterStat : ${sortedVariants}">
                            <button type="button"
                                    class="btn btn-outline-primary size-btn p-2"
                                    th:classappend="${iterStat.index == 0} ? 'active'"
                                    th:attr="data-price=${variant.price}, data-variant-id=${variant.id}">
                                <div class="d-flex flex-column text-center" style="min-width: 60px;">
                                    <span class="fw-bold fs-5" th:text="${variant.size.code}">M</span>
                                </div>
                            </button>
                        </th:block>
                    </div>
                </div>

                <!-- SỐ LƯỢNG -->
                <div class="d-flex align-items-center mb-4">
                    <h5 class="me-3 mb-0">Số lượng</h5>
                    <div class="input-group" style="width: 130px;">
                        <button class="btn btn-outline-secondary" type="button" id="btn-minus">−</button>
                        <input type="text" class="form-control text-center" value="1" id="quantity" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="btn-plus">+</button>
                    </div>
                </div>

                <!-- NÚT GIỎ HÀNG -->
                <button class="btn btn-success btn-lg w-100" id="add-to-cart-btn">
                    <i class="fas fa-cart-plus me-2"></i>
                    Thêm vào giỏ hàng - <span id="add-to-cart-price">0 ₫</span>
                </button>
            </div>
        </div>

        <!-- MÔ TẢ -->
        <div class="row mt-5">
            <div class="col-12">
                <h4>Mô tả sản phẩm</h4>
                <p th:text="${product.description}">Nội dung mô tả sản phẩm...</p>
            </div>
        </div>
    </div>

</th:block>
<th:block th:fragment="additionalJs">
    <script th:src="@{/js/product-detail.js}" defer></script>
</th:block>
</body>
</html>
