<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layouts/default_layout :: body(content=~{::content}, additionalJs=~{::additionalJs})}">
<head>
    <th:block th:fragment="additionalCss"></th:block>
</head>

<body>
<th:block th:fragment="content">
    <!-- Hero -->
    <section class="hero-section text-center d-flex align-items-center justify-content-center">
        <div class="container"></div>
    </section>

    <!-- SẢN PHẨM BÁN CHẠY -->
    <section class="container my-5" id="best-sellers">
        <h2 class="section-title">SẢN PHẨM BÁN CHẠY</h2>

        <div id="product-list-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-5 g-4">

            <!-- Lặp danh sách sản phẩm -->
            <div class="col" th:each="product : ${bestSellers}">
                <div class="card product-card h-100 shadow-sm border-0">

                    <!-- Ảnh sản phẩm có thể nhấn -->
                    <a th:href="@{/product/{id}(id=${product.id})}">
                        <img th:src="@{${product.imageUrl != null ? product.imageUrl : '/images/placeholder.png'}}"
                             class="card-img-top rounded-top"
                             th:alt="${product.name}" />
                    </a>

                    <div class="card-body d-flex flex-column text-center">

                        <!-- Tên sản phẩm có thể nhấn -->
                        <h5 class="card-title mb-3">
                            <a th:href="@{/product/{id}(id=${product.id})}"
                               class="text-decoration-none text-dark fw-semibold"
                               th:text="${product.name}">Tên sản phẩm</a>
                        </h5>

                        <!-- Giá -->
                        <p class="price mt-auto text-success fw-bold fs-5"
                           th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' ₫'">
                            Giá sản phẩm
                        </p>

                        <!-- Nút đặt mua -->
                        <a href="#" class="btn btn-success btn-add-to-cart mt-2" th:data-product-id="${product.id}">
                            <i class="fas fa-shopping-cart me-1"></i> Đặt mua
                        </a>
                    </div>
                </div>
            </div>

            <!-- Nếu chưa có sản phẩm -->
            <div th:if="${#lists.isEmpty(bestSellers)}" class="col-12 text-center">
                <p>Chưa có sản phẩm bán chạy nào.</p>
            </div>
        </div>

        <!-- Xem thêm -->
        <div class="text-center mt-5" th:if="${#lists.size(bestSellers) > 5}">
            <th:block th:with="hiddenProductCount=${#lists.size(bestSellers) - 5}">
                <button id="view-more-btn" class="btn btn-outline-success btn-lg"
                        th:text="'Xem thêm ' + ${hiddenProductCount} + ' sản phẩm'"></button>
            </th:block>
        </div>
    </section>

    <!-- GIỚI THIỆU -->
    <section class="container my-5 py-5 bg-light rounded shadow-sm text-center">
        <h2 class="section-title">Về AloTra</h2>
        <p class="lead w-75 mx-auto">
            AloTra mang đến những ly trà sữa chất lượng, pha chế từ nguyên liệu tươi ngon chọn lọc.
            Chúng tôi tin rằng mỗi ly trà sữa không chỉ là thức uống, mà còn là niềm vui, là khoảnh khắc thư giãn tuyệt vời của bạn.
        </p>
        <a th:href="@{/about}" class="btn btn-outline-success btn-lg mt-4">Tìm hiểu thêm</a>
    </section>
</th:block>

<!-- JAVASCRIPT -->
<th:block th:fragment="additionalJs">
    <script>
        $(document).ready(function() {
            console.log("✅ JavaScript Trang chủ hoạt động!");

            const productContainer = $("#product-list-container");
            const viewMoreBtn = $("#view-more-btn");

            // Ẩn bớt sản phẩm nếu >5
            if (productContainer.length && viewMoreBtn.length) {
                const hiddenProducts = productContainer.find(".col:gt(4)").hide();
                if (hiddenProducts.length === 0) {
                    viewMoreBtn.hide();
                }
                viewMoreBtn.on('click', function() {
                    hiddenProducts.show();
                    $(this).hide();
                });
            } else {
                console.log("Không tìm thấy product-list-container hoặc view-more-btn.");
            }

            // Toàn bộ card (trừ nút Đặt mua) đều có thể nhấn
            $(".product-card").on("click", function(e) {
                if (!$(e.target).closest(".btn-add-to-cart").length) {
                    const link = $(this).find("a[th\\:href]").attr("href");
                    if (link) window.location.href = link;
                }
            });
        });
    </script>
</th:block>
</body>
</html>
